<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Temperature Log</title>
    <!--script src="https://www.chartjs.org/dist/master/chart.js"></script-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>
    <!--script src="node_modules/chart.js/dist/chart.js"></script-->
</head>
<body style="display: flex; flex-direction: row; justify-content: center; min-height: 100vh; min-width: 960px;">
    <div style="width: 90%;">
        <p style="font-family: Calibri, sans-serif; font-size: 11pt; margin-top: 16px">System Monitor</p><!-- - <i>CPU: <b>{last_cpu_t}</b> degrees.</i></p-->
        <form action="#">
            <label style="font-family: Calibri, sans-serif; font-size: 12pt;" for="date_start">Start:</label>
            <input type="date" id="date_start" name="date_start" value="{date_start}" min="{date_min}" max="{date_max}" onchange="this.form.submit()"/>
            <!--label style="font-family: Calibri, sans-serif; font-size: 12pt;" for="date_end">End:</label>
            <input type="date" id="date_end" name="date_end" value="{date_end}" min="{date_min}" max="{date_max}"/-->
        </form>
        <canvas id="myChart1"></canvas>
        <canvas id="myChart2"></canvas>
        <p style="font-family: sans-serif; font-size: 9pt;">Showing {n_data_points} of {n_total_points} data points.</p>
    </div>
    <script>
        const option_tension = 0.25;
        const option_interpolation = 'monotone';
        const option_fill = false;
        const option_type = 'line';
        const option_aspect_ratio = 4;

        const bg_inside  = 'rgba(75, 192, 192, 0.2)';
        const bg_outside = 'rgba(255, 99, 132, 0.2)';

        const border_inside  = 'rgb(75, 192, 192)';
        const border_outside = 'rgb(255, 99, 132)';

        const dataset_inside = {
            label: "Inside",
            data: {inside_temp},
            fill: option_fill,
            borderColor: border_inside,
            backgroundColor: bg_inside,
            pointBorderColor: bg_inside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension,
        }

        const dataset_outside = {
            label: "Outside",
            data: {outside_temp},
            fill: option_fill,
            borderColor: border_outside,
            backgroundColor: bg_outside,
            pointBorderColor: bg_outside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension,
        }

        const dataset_inside_rh = {
            label: "Inside",
            data: {inside_rh},
            fill: option_fill,
            borderColor: border_inside,
            backgroundColor: bg_inside,
            pointBorderColor: bg_inside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension,
        }

        const dataset_outside_rh = {
            label: "Outside",
            data: {outside_rh},
            fill: option_fill,
            borderColor: border_outside,
            backgroundColor: bg_outside,
            pointBorderColor: bg_outside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension,
        }

        const option_scales_time = {
            title: {
                display: false,
                text: 'Time of Day'
            },
            type: 'time',//series'
            distribution: 'series',
            time: {
                displayFormats: {
                    hour: 'HH:mm',
                    minute: 'HH:mm'
                },
                minUnit: 'hour',
                isoWeekday: true,
                stepSize: 0.5
            }
        }

        const option_scales_temp = {
            x: option_scales_time,
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'Temperature'
                },
                suggestedMin: 0,
                suggestedMax: 30,
            }
        }

        const option_scales_rh = {
            x: option_scales_time,
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                    display: true,
                    text: '%'
                },
                suggestedMin: 0,
                suggestedMax: 100,
            }
        }

        const ctx1 = document.getElementById("myChart1").getContext("2d");
        const myChart1 = new Chart(ctx1, {
            type: option_type,
            data: {labels: {xval}, datasets: [dataset_inside, dataset_outside]},
            options: {
                animation: true,
                interaction: {
                    mode: 'nearest',
                    intersect: false
                },
                responsive: true,
                aspectRatio: option_aspect_ratio,
                locale: 'en-GB',
                elements: {
                    point: {
                        radius: 0
                    }
                },
                plugins: {
                    legend: {
                        position: 'left',
                    },
                    title: {
                        display: true,
                        text: 'Temperature',
                        align: 'end'
                    },
                    decimation: {
                        enabled: true,
                        algorithm: 'min-max'
                    },
                },
                scales: option_scales_temp
            },
        });

        const ctx2 = document.getElementById("myChart2").getContext("2d");
        const myChart2 = new Chart(ctx2, {
            type: option_type,
            data: {labels: {xval}, datasets: [dataset_inside_rh, dataset_outside_rh]},
            options: {
                animation: true,
                interaction: {
                    mode: 'nearest',
                    intersect: false
                },
                responsive: true,
                aspectRatio: option_aspect_ratio,
                locale: 'en-GB',
                elements: {
                    point: {
                        radius: 0
                    }
                },
                plugins: {
                    legend: {
                        position: 'left',
                    },
                    title: {
                        display: true,
                        text: 'Relative Humidity',
                        align: 'end'
                    },
                    decimation: {
                        enabled: true,
                        algorithm: 'min-max'
                    }
                },
                scales: option_scales_rh
            },
        });

    </script>
</body>
</html>
