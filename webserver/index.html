<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Temperature Log</title>
    <!--script src="https://www.chartjs.org/dist/master/chart.js"></script-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>
    <!--script src="node_modules/chart.js/dist/chart.js"></script-->
</head>
<body style="display: flex; flex-direction: row; justify-content: center; min-height: 100vh; min-width: 960px;">
    <div style="width: 90%;">
        <p style="font-family: Calibri, sans-serif; font-size: 11pt;">System Monitor</p>
        <form action="#">
            <label style="font-family: Calibri, sans-serif; font-size: 12pt;" for="file_select"></label>
            <select style="font-family: Calibri, sans-serif; font-size: 16pt; padding: 8px;" name="file" id="file_select" onchange="this.form.submit()">
                {opt_prec}
            </select>
            <!--input style="font-family: Calibri, sans-serif; font-size: 12pt; padding: 8px;" type="submit" value="Update Now" /-->
        </form>
        <canvas id="myChart"></canvas>
        <canvas id="myChart1"></canvas>
        <!--canvas id="myChart2"></canvas-->
        <!--canvas id="myChart3"></canvas-->
        <p style="font-family: sans-serif; font-size: 9pt;">A total of {n_data_points} data points were used to build these charts.</p>
    </div>
    <script>
        const option_tension = 0.25;
        const option_interpolation = 'monotone';
        const option_fill = false;
        const option_type = 'line';
        const option_aspect_ratio = 3;

        const bg_cpu     = 'rgba(255, 205, 86, 0.2)';
        const bg_cabinet = 'rgba(255, 159, 64, 0.2)';
        const bg_inside  = 'rgba(75, 192, 192, 0.2)';
        const bg_outside = 'rgba(255, 99, 132, 0.2)';

        const border_cpu     = 'rgb(255, 205, 86)';
        const border_cabinet = 'rgb(255, 159, 64)';
        const border_inside  = 'rgb(75, 192, 192)';
        const border_outside = 'rgb(255, 99, 132)';

        const dataset_inside = {
            label: "Inside",
            data: {inside_temp},
            fill: option_fill,
            borderColor: border_inside,
            backgroundColor: bg_inside,
            pointBorderColor: bg_inside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension
        }

        const dataset_outside = {
            label: "Outside",
            data: {outside_temp},
            fill: option_fill,
            borderColor: border_outside,
            backgroundColor: bg_outside,
            pointBorderColor: bg_outside,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension
        }

        const dataset_cpu = {
            label: "CPU",
            data: {cpu_temp},
            fill: option_fill,
            borderColor: border_cpu,
            backgroundColor: bg_cpu,
            pointBorderColor: bg_cpu,
            cubicInterpolationMode: option_interpolation,
            tension: option_tension
        }

        const dataset_last_minute = {
            label: "Last minute",
            data: [{last_cpu_t}, {last_inside_t}, {last_outside_t}],
            fill: option_fill,
            backgroundColor: [bg_cpu, bg_cabinet, bg_inside, bg_outside],
            borderColor: [border_cpu, border_cabinet, border_inside, border_outside],
            borderWidth: 2
        }

        const option_scales = {
            x: {
                title: {
                    display: true,
                    text: 'Time of Day'
                },
                type: 'time',//series'
                distribution: 'series',
                time: {
                    displayFormats: {
                        hour: 'HH:mm',
                        minute: 'HH:mm'
                    },
                    minUnit: 'hour',
                    isoWeekday: true,
                    stepSize: 0.5
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Temperature'
                },
            }
        }

        const ctx = document.getElementById("myChart").getContext("2d");
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {labels: ['CPU', 'Inside', 'Outside'], datasets: [dataset_last_minute]},
            options: {
                animation: true,
                responsive: true,
                    /*
                tooltipTemplate: '<%= value %>',
                tooltipFillColor: 'rgba(0,0,0,0)',
                tooltipFontColor: 'rgb(0,0,0)',
                tooltipEvents: [],
                tooltipCaretSize: 0,
                onAnimationComplete: function() {
                    this.showTooltip(this.datasets[0].bars, true);
                },
                    */
                aspectRatio: 9,
                plugins: {
                    legend: {
                        display: false,
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Last updated {last_date} {last_time}'
                    },
                },
                //scales: option_scales
            },
        });

        const ctx1 = document.getElementById("myChart1").getContext("2d");
        const myChart1 = new Chart(ctx1, {
            type: option_type,
            data: {labels: {xval}, datasets: [dataset_inside, dataset_outside, dataset_cpu]},
            options: {
                animation: true,
                interaction: {
                    intersect: false
                },
                responsive: true,
                aspectRatio: option_aspect_ratio,
                locale: 'en-GB',
                elements: {
                    point: {
                        radius: 0
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Room temperature'
                    },
                },
                scales: option_scales
            },
        });

        /*
        const ctx2 = document.getElementById("myChart2").getContext("2d");
        const myChart2 = new Chart(ctx2, {
            type: option_type,
            data: {labels: {xval}, datasets: [dataset_equipment]},
            options: {
                responsive: true,
                aspectRatio: option_aspect_ratio,
                plugins: {
                    legend: {
                        display: false,
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Equipment Temperature'
                    },
                },
                scales: option_scales
            },
        });

        const ctx3 = document.getElementById("myChart3").getContext("2d");
        const myChart3 = new Chart(ctx3, {
            type: option_type,
            data: {labels: {xval}, datasets: [dataset_cpu]},
            options: {
                responsive: true,
                aspectRatio: option_aspect_ratio,
                plugins: {
                    legend: {
                        display: false,
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'CPU Temperature'
                    },
                },
                scales: option_scales
            },
        });
         */
    </script>
</body>
</html>
